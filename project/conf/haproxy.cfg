global
        log /dev/log    local0
        log /dev/log    local1 notice
        chroot /var/lib/haproxy
        stats socket /run/haproxy/admin.sock mode 660 level admin
        stats timeout 30s
        user haproxy
        group haproxy
        daemon

defaults
        log     global
        mode    tcp
        option  tcplog
        option  dontlognull
        timeout connect 5000
        timeout client  50000
        timeout server  50000

frontend postgres_rw
    mode    tcp
    bind *:5000
    default_backend patroni_rw

backend patroni_rw
    mode    tcp
    option httpchk GET /leader
    http-check expect status 200
    default-server inter 3s fall 3 rise 2 on-marked-down shutdown-sessions
    server patroni-1 192.168.139.129:5432 check port 8008
    server patroni-2 192.168.139.142:5432 check port 8008
    server patroni-3 192.168.139.90:5432 check port 8008

frontend postgres_ro
    mode    tcp
    bind *:5001
    default_backend patroni_ro

backend patroni_ro
    mode    tcp
    balance roundrobin
    option httpchk GET /replica
    http-check expect status 200
    default-server inter 3s fall 3 rise 2
    server patroni-1 192.168.139.129:5432 check port 8008
    server patroni-2 192.168.139.142:5432 check port 8008
    server patroni-3 192.168.139.90:5432 check port 8008